"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e={};e.ratesTable={trigger:"#bw-rates-table",init:function(){var e=document.querySelector(this.trigger),t=this;null!==e&&(t.on("body","click",".bw-add-rate-line",function(e){e.preventDefault();var n=new XMLHttpRequest;n.onreadystatechange=function(e){if(4===n.readyState)if(200===n.status){var r="object"===_typeof(n.response)&&null!==n.response?n.response.data:JSON.parse(n.response).data;t.getTableBody().insertAdjacentHTML("beforeend",r),t.initSelect("#bw-rates-table tbody tr:last-child .bw-tail-select")}else console.log("Error: "+n.status)},n.open("POST",ajaxurl),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.responseType="json";var r="action=bw_add_rate_line&security="+encodeURIComponent(bwShippingMethodAjaxNonce),l=t.getTableRows();if(null!==l){var o=l[l.length-1],i=[];t.parseNodeChildrenSpecificTypeAction(o,["SELECT","INPUT"],function(e){if("SELECT"===e.tagName){var n=e.getAttribute("name"),r=t.getSelectedOptions(e);r.length>0?r.map(function(e){i.push(n+"="+encodeURIComponent(e.value))}):i.push(n+"=")}else i.push(e.getAttribute("name")+"="+encodeURIComponent(e.value))}),r+="&"+i.join("&")}n.send(r)}),t.on("body","click",".bw-remove-rate-line",function(e){e.preventDefault();var t=document.querySelector(".pricing-item.last_selected");null!==t&&t.remove()}),t.on("body","click",".bw-remove-line",function(e){e.preventDefault();var n=t.getParentRow(e.target);null!==n&&n.remove()}),t.on("body","change",".bw-change-state",function(e,n){var r=null!==e.target&&!1===e.target.checked,l=t.getParentRow(e.target);null!==l&&t.setRowState(l,r)}),t.initSelect(".bw-tail-select"),t.submitForm=t.submitForm.bind(t),document.getElementById("mainform").addEventListener("submit",t.submitForm))},getParentRow:function(e){for(;null!==e&&e!==undefined&&"tr"!==e.tagName.toLowerCase();)e=e.parentNode;return e===undefined?null:e},setRowState:function(e,t){var n=e.querySelectorAll('input[type="text"], input[type="number"], select'),r=!0,l=!1,o=undefined;try{for(var i,a=n[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var c=i.value;if("select"===c.tagName.toLowerCase()){var u=tail.select(c);t?u.disable():u.enable()}else c.disabled=t}}catch(s){l=!0,o=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(l)throw o}}this.initSelect("#bw-rates-table .bw-tail-select"),t?e.classList.add("disabled"):e.classList.remove("disabled")},getSelectedOptions:function(e,t){for(var n,r=[],l=0,o=e.options.length;l<o;l++)(n=e.options[l]).selected&&(r.push(n),t&&t(n));return r},submitForm:function(e){e.preventDefault();var t=[],n=document.querySelectorAll(".pricing-item");if(n.length>0)for(var r=0;r<n.length;r++){var l=n[r],o=l.querySelector("td .state"),i=o.checked?o.getAttribute("data-checked"):o.getAttribute("data-unchecked"),a=l.querySelector("td .shipping-class"),c=document.querySelector("#bw-rates-table").getAttribute("data-default-shipping-class"),u={"price-from":l.querySelector("td .price-from").value,"price-to":l.querySelector("td .price-to").value,"weight-from":l.querySelector("td .weight-from").value,"weight-to":l.querySelector("td .weight-to").value,"shipping-class":null===a?[c]:Array.apply(null,a.options).filter(function(e){return e.selected}).map(function(e){return e.value}),"parcel-point-network":Array.apply(null,l.querySelector("td .parcel-point-network").options).filter(function(e){return e.selected}).map(function(e){return e.value}),pricing:i,"flat-rate":l.querySelector("td .flat-rate").value,state:l.querySelector("td .state").checked};t.push(u)}var s=document.querySelectorAll(".pricing-item input, .pricing-item select");if(s.length>0)for(var d=0;d<s.length;d++){s[d].disabled=!0}var p=document.createElement("input");p.setAttribute("type","hidden"),p.setAttribute("name","pricing-items"),p.value=JSON.stringify(t);var f=document.createElement("input");return f.setAttribute("type","hidden"),f.setAttribute("name","save"),f.value=1,document.querySelector(this.trigger).appendChild(p),document.querySelector(this.trigger).appendChild(f),document.getElementById("mainform").removeEventListener("submit",this.submitForm),document.getElementById("mainform").submit(),!0},initSelect:function(e){for(var t=this,n=tail.select(e,{locale:bwLocale,multiShowCount:!1,multiSelectAll:!0,cbComplete:function(e){var n=t.getPlaceholderText(this),r=e.querySelector(".label-inner");null!==r&&(r.innerHTML=n)}}),r=function(e){var r=n[e];r.on("close",function(){t.refreshSelectText(this)}),r.e.name.indexOf('["pricing"]')>-1&&r.on("change",function(e,t){var n=/pricing-items\[(\d+)\]\["pricing"\]/g.exec(r.e.name);if(null!==n){var l=n[1],o=document.getElementById("flat-rate-"+l);null!==o&&("rate"===e.key?(o.removeAttribute("disabled"),""===o.value&&(o.value=0)):o.setAttribute("disabled","disabled"))}})},l=0;l<n.length;l++)r(l)},getPlaceholderText:function(e){if(e.options.length>0){for(var t=[],n=0;n<e.options.length;n++){var r=e.options[n];!0===r.selected&&t.push(r.value)}return t.length>0?t.length===e.options.length?tail.select.strings[bwLocale].all:t.join(", "):tail.select.strings[bwLocale].none}return tail.select.strings[bwLocale].emptySearch},refreshSelectText:function(e){var t=this.getPlaceholderText(e);e.config("placeholder",t)},getTableBody:function(){var e=document.querySelector(this.trigger).querySelector("tbody");return null===e?null:e},getTableRows:function(){var e=this.getTableBody();return null===e?null:0===e.childElementCount?null:e.children},parseNodeChildrenSpecificTypeAction:function(e,t,n){if(e.hasChildNodes())for(var r=e.childNodes,l=0;l<r.length;l++){var o=r[l];-1!==t.indexOf(o.tagName)&&n(o),this.parseNodeChildrenSpecificTypeAction(o,t,n)}return e},on:function(e,t,n,r){var l=document.querySelector(e);l.addEventListener(t,function(e){for(var t=l.querySelectorAll(n),o=e.target,i=0,a=t.length;i<a;i++)for(var c=o,u=t[i];c&&c!==l;){if(c===u)return r.call(u,e);c=c.parentNode}})}},document.addEventListener("DOMContentLoaded",function(){e.ratesTable.init()})}();